# ボディビルダー比較アプリケーション仕様書

## 1. アプリケーション概要
ボディビルダーの画像を基準画像と比較し、美しさをスコア化してランキング表示するWebアプリケーション

## 2. 主要機能
### 2.1 画像アップロード機能
- **基準画像**: 1枚（比較の基準となる画像）
- **比較対象画像**: 複数枚（基準と比較される画像群）
- **アップロード方法**: 
  - ドラッグ&ドロップ
  - ファイル選択ボタン
- **画像表示**:
  - サムネイル表示（小サイズ）
  - クリックで拡大表示

### 2.2 比較・判定機能
- **処理内容**: 基準画像に対する各比較対象画像の相対的な美しさを判定
- **判定基準**: AIによる画像解析（dify APIを使用）
- **出力**: 各画像のスコアとランキング

### 2.3 結果表示機能
- **表示形式**: スコア付きランキング形式
- **表示内容**:
  - 順位
  - 画像サムネイル
  - スコア（数値）
- **保存**: なし（表示のみ）

## 3. 技術スタック
### 3.1 フロントエンド
- **フレームワーク**: Svelte v5
- **言語**: TypeScript
- **スタイリング**: GrabCSS（https://github.com/grabss/grabcss）

### 3.2 バックエンド
- **AI処理**: dify（クラウド版API）
  - 画像比較判定
  - スコア算出
- **実行環境**: Node.js

### 3.3 インフラ
- **開発環境**: Docker Compose
  - Svelteアプリケーションコンテナ
  - ※difyはクラウド版を使用（将来的にローカル化も可能）
- **本番環境**: 未定

### 3.4 データベース
- なし（セッション内でのみデータを保持）

## 4. ユーザーフロー
1. ユーザーが基準画像（1枚）をアップロード
2. 比較対象画像（複数枚）をアップロード
3. 「比較実行」ボタンをクリック
4. dify APIで画像を解析・スコア算出
5. スコア付きランキングを表示

## 5. エラー処理
### 5.1 バリデーション
- **画像以外のファイル**: フロントエンドでバリデーション、エラーメッセージ表示
- **基準画像未設定**: 比較実行ボタンを無効化

### 5.2 API エラー
- **dify API エラー**: エラーメッセージと再試行ボタンを表示

## 6. 環境変数設定
```env
# API設定
DIFY_API_URL=https://api.dify.ai/v1  # 本番: クラウド版URL、開発: ローカルURL切替可能
DIFY_API_KEY=your_api_key_here

# アプリケーション設定
NODE_ENV=development
PORT=3015
```

## 7. 開発フェーズ
### Phase 1: 環境構築
- Docker Compose環境のセットアップ
- Svelte v5 + TypeScriptプロジェクト初期化

### Phase 2: API連携
- difyクラウド版アカウント作成
- API接続設定
- 通信テスト実装

### Phase 3: 簡易UI実装
- 画像アップロード機能
- 基本的な比較実行機能
- シンプルな結果表示

### Phase 4: 本格UI実装
- デザイン改善
- UX最適化
- エラーハンドリング強化

## 8. ディレクトリ構造（予定）
```
judgment-app/
├── docker-compose.yml
├── Dockerfile
├── package.json
├── .env.example
├── src/
│   ├── routes/
│   │   └── +page.svelte
│   ├── lib/
│   │   ├── components/
│   │   │   ├── ImageUploader.svelte
│   │   │   ├── ResultDisplay.svelte
│   │   │   └── ImageModal.svelte
│   │   ├── api/
│   │   │   └── dify.ts
│   │   └── types/
│   │       └── index.ts
│   └── app.html
├── static/
└── vite.config.ts
```

## 9. API仕様（予定）
### dify API リクエスト
```typescript
interface ComparisonRequest {
  baseImage: string;  // Base64エンコード画像
  targetImages: string[];  // Base64エンコード画像配列
}
```

### dify API レスポンス
```typescript
interface ComparisonResponse {
  results: Array<{
    imageIndex: number;
    score: number;  // 0-100
    analysis?: string;  // オプション：AI分析コメント
  }>;
}
```

## 10. 非機能要件
- **パフォーマンス**: 画像は圧縮してからAPI送信
- **セキュリティ**: APIキーは環境変数で管理
- **アクセシビリティ**: 基本的なキーボード操作対応
- **レスポンシブ**: モバイル・デスクトップ両対応

## 11. 制約事項
- 画像は一時的にメモリ上でのみ保持
- 結果の永続化なし
- ユーザー認証なし
- 画像サイズ制限：TBD（dify API制限に依存）